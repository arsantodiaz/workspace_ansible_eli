

Add-LocalGroupMember -Group "Remote Management Users" -Member "endiaz"
Add-LocalGroupMember -Group "Administrators" -Member "endiaz"

New-ItemProperty -Path HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System -Name LocalAccountTokenFilterPolicy -Value 1 -PropertyType DWord -Force

New-NetFirewallRule -Name "Allow_WinRM_HTTP" -DisplayName "Allow WinRM HTTP" -Enabled True -Direction Inbound -Protocol TCP -Action Allow -LocalPort 5985
Restart-Service WinRM


ansible -i inventory uat_windows -m win_ping

ansible-vault encrypt_string '2212ChillaBocil' --name 'ansible_password'
nano host_vars/UAT-WS06.yml


Add-LocalGroupMember -Group "Remote Management Users" -Member "elife\sys-it-dc"
Add-LocalGroupMember -Group "Administrators" -Member "elife\sys-it-dc"

Add-LocalGroupMember -Group "Remote Management Users" -Member "adminbas"
Add-LocalGroupMember -Group "Administrators" -Member "adminbas"


sys-it-dc
2212chillabocil





Solusi untuk ELI-DB21
Silakan Remote Desktop (RDP) ke server 192.168.10.53 (ELI-DB21), lalu buka PowerShell as Administrator, dan jalankan langkah ini:

1. Cek Status Izin Shell
Ketik perintah ini:

PowerShell

winrm get winrm/config/winrs
Cari baris: AllowRemoteShellAccess. Kalau isinya false, itulah biang keroknya.

2. Aktifkan Paksa (The Fix)
Ketik perintah ini untuk mengizinkan remote shell:

PowerShell

Set-Item WSMan:\localhost\Shell\AllowRemoteShellAccess -Value $true
Atau pakai perintah cmd style:

DOS

winrm set winrm/config/winrs @{AllowRemoteShellAccess="true"}



# 1. Masuk ke lokasi Registry Policy WinRM
$path = "HKLM:\SOFTWARE\Policies\Microsoft\Windows\WinRM\Service\WinRS"

# 2. Cek kalau path-nya belum ada, kita buat dulu
if (!(Test-Path $path)) { New-Item -Path $path -Force }

# 3. Paksa nilainya jadi 1 (True/Enabled)
Set-ItemProperty -Path $path -Name "AllowRemoteShellAccess" -Value 1 -Type DWord




3. Cek Memory (Penyebab Error 500)
Kadang error "Code 500" juga muncul karena jatah memori untuk remote user terlalu kecil. Sekalian naikkan biar aman:

PowerShell

Set-Item WSMan:\localhost\Shell\MaxMemoryPerShellMB -Value 2048
4. Restart Service WinRM
Supaya efeknya jalan:

PowerShell

Restart-Service WinRM
Setelah itu, coba ping lagi dari Ansible:

Bash

ansible ELI-DB21 -i inventory -m win_ping
Kalau sudah SUCCESS, baru kita urus temannya yang satu lagi (ELI-DB11) yang masalah password/credential.





# 1. Pastikan user ada & passwordnya SAMA PERSIS dengan di Inventory/Host_vars
# (Ganti password di bawah sesuai yang kamu pakai di Ansible)
net user endiaz 2212ChillaBocil /add /y

# 2. Masukkan ke grup Admin
net localgroup administrators endiaz /add

----

PS C:\Windows\system32> $UserName = "endiaz"
PS C:\Windows\system32> try {
>>     # Cari user di Active Directory menggunakan ADSI Searcher
>>     $Searcher = [ADSISearcher]"(sAMAccountName=$UserName)"
>>     $User = $Searcher.FindOne()
>>
>>     if ($User) {
>>         $Props = $User.Properties
>>
>>         # 1. Estimasi Dibuat (WhenCreated)
>>         $Created = $Props.whencreated[0]
>>
>>         # 2. Terakhir Login (LastLogon - dikonversi dari filetime)
>>         $LastLogonRaw = $Props.lastlogon[0]
>>         $LastLogon = if ($LastLogonRaw) { [DateTime]::FromFileTime($LastLogonRaw) } else { "Belum Pernah" }
>>
>>         # 3. Password Terakhir Diubah (PasswordLastSet)
>>         $PwdLastSetRaw = $Props.pwdlastset[0]
>>         $PwdLastSet = if ($PwdLastSetRaw) { [DateTime]::FromFileTime($PwdLastSetRaw) } else { "Unknown" }
>>
>>         Write-Host "Name           : $UserName"
>>         Write-Host "Created        : $Created"
>>         Write-Host "Last Logon     : $LastLogon"
>>         Write-Host "Pwd Last Set   : $PwdLastSet"
>>     } else {
>>         Write-Host "User $UserName tidak ditemukan di Domain."
>>     }
>> } catch {
>>     Write-Host "Gagal menarik data dari AD: $($_.Exception.Message)"
>> }
Name           : endiaz
Created        : 08/23/2019 11:23:12
Last Logon     : 01/17/2026 21:39:14
Pwd Last Set   : 01/14/2026 10:01:59
PS C:\Windows\system32>

$UserName = "bona"
try {
    # Cari user di Active Directory menggunakan ADSI Searcher
    $Searcher = [ADSISearcher]"(sAMAccountName=$UserName)"
    $User = $Searcher.FindOne()

    if ($User) {
        $Props = $User.Properties

        # 1. Estimasi Dibuat (WhenCreated)
        $Created = $Props.whencreated[0]

        # 2. Terakhir Login (LastLogon - dikonversi dari filetime)
        $LastLogonRaw = $Props.lastlogon[0]
        $LastLogon = if ($LastLogonRaw) { [DateTime]::FromFileTime($LastLogonRaw) } else { "Belum Pernah" }

        # 3. Password Terakhir Diubah (PasswordLastSet)
        $PwdLastSetRaw = $Props.pwdlastset[0]
        $PwdLastSet = if ($PwdLastSetRaw) { [DateTime]::FromFileTime($PwdLastSetRaw) } else { "Unknown" }

        Write-Host "Name           : $UserName"
        Write-Host "Created        : $Created"
        Write-Host "Last Logon     : $LastLogon"
        Write-Host "Pwd Last Set   : $PwdLastSet"
    } else {
        Write-Host "User $UserName tidak ditemukan di Domain."
    }
} catch {
    Write-Host "Gagal menarik data dari AD: $($_.Exception.Message)"
}



ansible-playbook audit_csv.yml --vault-password-file ~/.vault_pass
ansible-playbook audit_csv.yml --tags "windows" --vault-password-file ~/.vault_pass

